<UserControl x:Class="PersonalDashboard.Views.ToDoWidget"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="Transparent">
    <!-- Outer grid: input row + list -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- INPUT ROW -->
        <DockPanel Margin="0,0,0,12">
            <!-- Add button docks right; TextBox fills remaining space -->
            <Button Content="Add"
              Command="{Binding AddTaskCommand}"
              DockPanel.Dock="Right"/>
            <TextBox Text="{Binding NewTaskDescription, UpdateSourceTrigger=PropertyChanged}"
               Margin="0,0,8,0"
               ToolTip="Type a task and press Add or Enter"/>
        </DockPanel>

        <!-- TASK LIST -->
        <!-- TASK LIST -->
        <Border Grid.Row="1"
        Background="Transparent"
        BorderBrush="#22FFFFFF" BorderThickness="1"
        CornerRadius="10" Padding="6">
            <ListBox ItemsSource="{Binding Tasks}"
           ScrollViewer.VerticalScrollBarVisibility="Auto"
           ScrollViewer.CanContentScroll="True"
           VirtualizingStackPanel.IsVirtualizing="True"
           VirtualizingStackPanel.VirtualizationMode="Recycling"
           MaxHeight="340">
                <!-- keep this a bit less than the card's MaxHeight -->
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Checkbox -->
                            <CheckBox Grid.Column="0"
                    IsChecked="{Binding IsCompleted}"
                    VerticalAlignment="Center" Margin="0,0,8,0"/>

                            <!-- Description with strikethrough when completed -->
                            <TextBlock Grid.Column="1" Text="{Binding Description}" VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                <Setter Property="Opacity" Value="0.8"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <!-- Remove button -->
                            <Button Grid.Column="2" Content="✕"
                  ToolTip="Remove"
                  Command="{Binding DataContext.RemoveTaskCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  CommandParameter="{Binding}" />
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>

                <!-- Subtle spacing between items -->
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0,4"/>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </Border>

    </Grid>
</UserControl>
